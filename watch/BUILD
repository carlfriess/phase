load("@//external/nRF5:nRF5.bzl", "nRF5_binary")
load("@//tools/img:embed.bzl", "embed_img")

# Photo by Manuel Will on Unsplash
# https://unsplash.com/photos/gd3t5Dtbwkw
embed_img(
    name = "background",
    img = "background.jpeg",
)

nRF5_binary(
    srcs = glob(
        [
            "**/*.c",
            "**/*.cpp",
            "**/*.h",
        ],
        exclude = ["config/*"],
    ) + [
        ":background",
        "@nRF5//:components/ble/ble_advertising/ble_advertising.c",
        "@nRF5//:components/ble/ble_db_discovery/ble_db_discovery.c",
        "@nRF5//:components/ble/ble_services/ble_ancs_c/ancs_app_attr_get.c",
        "@nRF5//:components/ble/ble_services/ble_ancs_c/ancs_attr_parser.c",
        "@nRF5//:components/ble/ble_services/ble_ancs_c/nrf_ble_ancs_c.c",
        "@nRF5//:components/ble/ble_services/ble_cts_c/ble_cts_c.c",
        "@nRF5//:components/ble/ble_services/experimental_gatts_c/nrf_ble_gatts_c.c",
        "@nRF5//:components/ble/common/ble_advdata.c",
        "@nRF5//:components/ble/common/ble_conn_params.c",
        "@nRF5//:components/ble/common/ble_conn_state.c",
        "@nRF5//:components/ble/common/ble_srv_common.c",
        "@nRF5//:components/ble/nrf_ble_gatt/nrf_ble_gatt.c",
        "@nRF5//:components/ble/nrf_ble_gq/nrf_ble_gq.c",
        "@nRF5//:components/ble/nrf_ble_qwr/nrf_ble_qwr.c",
        "@nRF5//:components/ble/peer_manager/auth_status_tracker.c",
        "@nRF5//:components/ble/peer_manager/gatt_cache_manager.c",
        "@nRF5//:components/ble/peer_manager/gatts_cache_manager.c",
        "@nRF5//:components/ble/peer_manager/id_manager.c",
        "@nRF5//:components/ble/peer_manager/peer_data_storage.c",
        "@nRF5//:components/ble/peer_manager/peer_database.c",
        "@nRF5//:components/ble/peer_manager/peer_id.c",
        "@nRF5//:components/ble/peer_manager/peer_manager.c",
        "@nRF5//:components/ble/peer_manager/peer_manager_handler.c",
        "@nRF5//:components/ble/peer_manager/pm_buffer.c",
        "@nRF5//:components/ble/peer_manager/security_dispatcher.c",
        "@nRF5//:components/ble/peer_manager/security_manager.c",
        "@nRF5//:components/boards/boards.c",
        "@nRF5//:components/libraries/atomic/nrf_atomic.c",
        "@nRF5//:components/libraries/atomic_fifo/nrf_atfifo.c",
        "@nRF5//:components/libraries/atomic_flags/nrf_atflags.c",
        "@nRF5//:components/libraries/balloc/nrf_balloc.c",
        "@nRF5//:components/libraries/bsp/bsp.c",
        "@nRF5//:components/libraries/bsp/bsp_btn_ble.c",
        "@nRF5//:components/libraries/button/app_button.c",
        "@nRF5//:components/libraries/crc16/crc16.c",
        "@nRF5//:components/libraries/experimental_section_vars/nrf_section_iter.c",
        "@nRF5//:components/libraries/fds/fds.c",
        "@nRF5//:components/libraries/fstorage/nrf_fstorage.c",
        "@nRF5//:components/libraries/fstorage/nrf_fstorage_sd.c",
        "@nRF5//:components/libraries/hardfault/hardfault_implementation.c",
        "@nRF5//:components/libraries/log/src/nrf_log_backend_rtt.c",
        "@nRF5//:components/libraries/log/src/nrf_log_backend_serial.c",
        "@nRF5//:components/libraries/log/src/nrf_log_backend_uart.c",
        "@nRF5//:components/libraries/log/src/nrf_log_default_backends.c",
        "@nRF5//:components/libraries/log/src/nrf_log_frontend.c",
        "@nRF5//:components/libraries/log/src/nrf_log_str_formatter.c",
        "@nRF5//:components/libraries/memobj/nrf_memobj.c",
        "@nRF5//:components/libraries/pwr_mgmt/nrf_pwr_mgmt.c",
        "@nRF5//:components/libraries/queue/nrf_queue.c",
        "@nRF5//:components/libraries/ringbuf/nrf_ringbuf.c",
        "@nRF5//:components/libraries/scheduler/app_scheduler.c",
        "@nRF5//:components/libraries/sortlist/nrf_sortlist.c",
        "@nRF5//:components/libraries/strerror/nrf_strerror.c",
        "@nRF5//:components/libraries/timer/app_timer2.c",
        "@nRF5//:components/libraries/timer/drv_rtc.c",
        "@nRF5//:components/libraries/util/app_error.c",
        "@nRF5//:components/libraries/util/app_error_handler_gcc.c",
        "@nRF5//:components/libraries/util/app_error_weak.c",
        "@nRF5//:components/libraries/util/app_util_platform.c",
        "@nRF5//:components/libraries/util/nrf_assert.c",
        "@nRF5//:components/softdevice/common/nrf_sdh.c",
        "@nRF5//:components/softdevice/common/nrf_sdh_ble.c",
        "@nRF5//:components/softdevice/common/nrf_sdh_soc.c",
        "@nRF5//:external/fprintf/nrf_fprintf.c",
        "@nRF5//:external/fprintf/nrf_fprintf_format.c",
        "@nRF5//:external/segger_rtt/SEGGER_RTT.c",
        "@nRF5//:external/segger_rtt/SEGGER_RTT_Syscalls_GCC.c",
        "@nRF5//:external/segger_rtt/SEGGER_RTT_printf.c",
        "@nRF5//:external/utf_converter/utf.c",
        "@nRF5//:integration/nrfx/legacy/nrf_drv_clock.c",
        "@nRF5//:integration/nrfx/legacy/nrf_drv_uart.c",
        "@nRF5//:modules/nrfx/drivers/src/nrfx_clock.c",
        "@nRF5//:modules/nrfx/drivers/src/nrfx_gpiote.c",
        "@nRF5//:modules/nrfx/drivers/src/nrfx_spi.c",
        "@nRF5//:modules/nrfx/drivers/src/nrfx_spim.c",
        "@nRF5//:modules/nrfx/drivers/src/nrfx_ppi.c",
        "@nRF5//:modules/nrfx/drivers/src/nrfx_timer.c",
        "@nRF5//:modules/nrfx/drivers/src/nrfx_uart.c",
        "@nRF5//:modules/nrfx/drivers/src/nrfx_uarte.c",
        "@nRF5//:modules/nrfx/drivers/src/prs/nrfx_prs.c",
        "@nRF5//:modules/nrfx/mdk/gcc_startup_nrf52.S",
        "@nRF5//:modules/nrfx/mdk/system_nrf52.c",
        "@nRF5//:modules/nrfx/soc/nrfx_atomic.c",
    ],
    linker_cmd = "config/ble_app_ancs_c_gcc_nrf52.ld",
    linkopts = [
        "-lstdc++",
        "-Wl,-Map=output.map",
    ],
    sdk_config_prefix = "config",
    deps = [
        "//lib:GC9A01",
        "//lib:ui",
        "//lib:ui-watch",
        "//lib/fonts:opensans-12",
        "//lib/fonts:quicksand-64",
    ],
)

exports_files(
    [
        "spi.c",
        "spi.h",
    ],
    visibility = ["//graphics_demo:__pkg__"],
)
