package(default_visibility = ["//visibility:public"])

load("@phase//external/nRF5:nRF5.bzl", "nRF5_binary")

# nRF5 SDK definitions

filegroup(
    name = "hdrs",
    srcs = glob([
        "components/*.h",
        "components/ble/**/*.h",
        "components/boards/*.h",
        "components/libraries/**/*.h",
        "components/nfc/**/*.h",
        "components/toolchain/cmsis/include/*.h",
        "external/fprintf/*.h",
        "external/segger_rtt/*.h",
        "external/utf_converter/*.h",
        "integration/nrfx/**/*.h",
        "modules/nrfx/**/*.h",
    ]),
)

filegroup(
    name = "hdrs_nosd",
    srcs = glob([
        "components/drivers_nrf/nrf_soc_nosd/*.h",
    ]),
)

filegroup(
    name = "hdrs_s132",
    srcs = glob([
        "components/softdevice/common/*.h",
        "components/softdevice/s132/headers/*.h",
        "components/softdevice/s132/headers/nrf52/*.h",
    ]),
)

filegroup(
    name = "hdrs_s140",
    srcs = glob([
        "components/softdevice/common/*.h",
        "components/softdevice/s140/headers/*.h",
        "components/softdevice/s140/headers/nrf52/*.h",
    ]),
)

includes = glob(
    include = [
        "components/libraries/*",
    ],
    exclude_directories = 0,
) + [
    "components",
    "components/ble/ble_advertising",
    "components/ble/ble_db_discovery",
    "components/ble/ble_dtm",
    "components/ble/ble_racp",
    "components/ble/ble_services/ble_ancs_c",
    "components/ble/ble_services/ble_ans_c",
    "components/ble/ble_services/ble_bas",
    "components/ble/ble_services/ble_bas_c",
    "components/ble/ble_services/ble_cscs",
    "components/ble/ble_services/ble_cts_c",
    "components/ble/ble_services/ble_dfu",
    "components/ble/ble_services/ble_dis",
    "components/ble/ble_services/ble_gls",
    "components/ble/ble_services/ble_hids",
    "components/ble/ble_services/ble_hrs",
    "components/ble/ble_services/ble_hrs_c",
    "components/ble/ble_services/ble_hts",
    "components/ble/ble_services/ble_ias",
    "components/ble/ble_services/ble_ias_c",
    "components/ble/ble_services/ble_lbs",
    "components/ble/ble_services/ble_lbs_c",
    "components/ble/ble_services/ble_lls",
    "components/ble/ble_services/ble_nus",
    "components/ble/ble_services/ble_nus_c",
    "components/ble/ble_services/ble_rscs",
    "components/ble/ble_services/ble_rscs_c",
    "components/ble/ble_services/ble_tps",
    "components/ble/ble_services/experimental_gatts_c",
    "components/ble/common",
    "components/ble/nrf_ble_gatt",
    "components/ble/nrf_ble_gq",
    "components/ble/nrf_ble_qwr",
    "components/ble/peer_manager",
    "components/boards",
    "components/libraries/bootloader/ble_dfu",
    "components/libraries/log/src",
    "components/libraries/usbd/class/audio",
    "components/libraries/usbd/class/cdc",
    "components/libraries/usbd/class/cdc/acm",
    "components/libraries/usbd/class/hid",
    "components/libraries/usbd/class/hid/generic",
    "components/libraries/usbd/class/hid/kbd",
    "components/libraries/usbd/class/hid/mouse",
    "components/libraries/usbd/class/msc",
    "components/nfc/ndef/conn_hand_parser",
    "components/nfc/ndef/conn_hand_parser/ac_rec_parser",
    "components/nfc/ndef/conn_hand_parser/ble_oob_advdata_parser",
    "components/nfc/ndef/conn_hand_parser/le_oob_rec_parser",
    "components/nfc/ndef/connection_handover/ac_rec",
    "components/nfc/ndef/connection_handover/ble_oob_advdata",
    "components/nfc/ndef/connection_handover/ble_pair_lib",
    "components/nfc/ndef/connection_handover/ble_pair_msg",
    "components/nfc/ndef/connection_handover/common",
    "components/nfc/ndef/connection_handover/ep_oob_rec",
    "components/nfc/ndef/connection_handover/hs_rec",
    "components/nfc/ndef/connection_handover/le_oob_rec",
    "components/nfc/ndef/generic/message",
    "components/nfc/ndef/generic/record",
    "components/nfc/ndef/launchapp",
    "components/nfc/ndef/parser/message",
    "components/nfc/ndef/parser/record",
    "components/nfc/ndef/text",
    "components/nfc/ndef/uri",
    "components/nfc/platform",
    "components/nfc/t2t_lib",
    "components/nfc/t2t_parser",
    "components/nfc/t4t_lib",
    "components/nfc/t4t_parser/apdu",
    "components/nfc/t4t_parser/cc_file",
    "components/nfc/t4t_parser/hl_detection_procedure",
    "components/nfc/t4t_parser/tlv",
    "components/toolchain/cmsis/include",
    "external/fprintf",
    "external/segger_rtt",
    "external/utf_converter",
    "integration/nrfx",
    "integration/nrfx/legacy",
    "modules/nrfx",
    "modules/nrfx/drivers/include",
    "modules/nrfx/hal",
    "modules/nrfx/mdk",
]

includes_nosd = [
    "components/drivers_nrf/nrf_soc_nosd",
]

includes_s132 = [
    "components/softdevice/common",
    "components/softdevice/s132/headers",
    "components/softdevice/s132/headers/nrf52",
]

includes_s140 = [
    "components/softdevice/common",
    "components/softdevice/s140/headers",
    "components/softdevice/s140/headers/nrf52",
]

cc_library(
    name = "sdk",
    srcs = [":hdrs"],
    hdrs = [":hdrs"],
    data = ["modules/nrfx/mdk"],
    includes = includes,
    linkopts = [
        "-L $(location @nRF5//:modules/nrfx/mdk)",
    ],
    linkstatic = 1,
    deps = [
        "modules/nrfx/mdk/nrf_common.ld",
    ],
)

cc_library(
    name = "nosd",
    srcs = [":hdrs_nosd"],
    hdrs = [":hdrs_nosd"],
    includes = includes_nosd,
)

cc_library(
    name = "s132",
    srcs = [":hdrs_s132"],
    hdrs = [":hdrs_s132"],
    includes = includes_s132,
)

cc_library(
    name = "s140",
    srcs = [":hdrs_s140"],
    hdrs = [":hdrs_s140"],
    includes = includes_s140,
)

exports_files(glob(["**"]))

# Configuration describing the target platform

config_setting(
    name = "target_arm_none",
    constraint_values = [
        "@platforms//cpu:arm",
        "@platforms//os:none",
    ],
)

# Configurations describing the host platform

config_setting(
    name = "host_macOS",
    values = {"host_cpu": "darwin"},
)

config_setting(
    name = "host_linux",
    values = {"host_cpu": "k8"},
)

# Examples

nRF5_binary(
    name = "blinky",
    srcs = [
        "components/boards/boards.c",
        "components/libraries/atomic/nrf_atomic.c",
        "components/libraries/balloc/nrf_balloc.c",
        "components/libraries/log/src/nrf_log_frontend.c",
        "components/libraries/log/src/nrf_log_str_formatter.c",
        "components/libraries/memobj/nrf_memobj.c",
        "components/libraries/ringbuf/nrf_ringbuf.c",
        "components/libraries/strerror/nrf_strerror.c",
        "components/libraries/util/app_error.c",
        "components/libraries/util/app_error_handler_gcc.c",
        "components/libraries/util/app_error_weak.c",
        "components/libraries/util/app_util_platform.c",
        "components/libraries/util/nrf_assert.c",
        "examples/peripheral/blinky/main.c",
        "external/fprintf/nrf_fprintf.c",
        "external/fprintf/nrf_fprintf_format.c",
        "modules/nrfx/mdk/gcc_startup_nrf52.S",
        "modules/nrfx/mdk/system_nrf52.c",
        "modules/nrfx/soc/nrfx_atomic.c",
    ],
    linker_cmd = "examples/peripheral/blinky/pca10040/blank/armgcc/blinky_gcc_nrf52.ld",
    sdk_config_prefix = "examples/peripheral/blinky/pca10040/blank/config",
)

nRF5_binary(
    name = "ble_app_cts_c",
    srcs = [
        "components/ble/ble_advertising/ble_advertising.c",
        "components/ble/ble_db_discovery/ble_db_discovery.c",
        "components/ble/ble_services/ble_cts_c/ble_cts_c.c",
        "components/ble/common/ble_advdata.c",
        "components/ble/common/ble_conn_params.c",
        "components/ble/common/ble_conn_state.c",
        "components/ble/common/ble_srv_common.c",
        "components/ble/nrf_ble_gatt/nrf_ble_gatt.c",
        "components/ble/nrf_ble_gq/nrf_ble_gq.c",
        "components/ble/nrf_ble_qwr/nrf_ble_qwr.c",
        "components/ble/peer_manager/auth_status_tracker.c",
        "components/ble/peer_manager/gatt_cache_manager.c",
        "components/ble/peer_manager/gatts_cache_manager.c",
        "components/ble/peer_manager/id_manager.c",
        "components/ble/peer_manager/peer_data_storage.c",
        "components/ble/peer_manager/peer_database.c",
        "components/ble/peer_manager/peer_id.c",
        "components/ble/peer_manager/peer_manager.c",
        "components/ble/peer_manager/peer_manager_handler.c",
        "components/ble/peer_manager/pm_buffer.c",
        "components/ble/peer_manager/security_dispatcher.c",
        "components/ble/peer_manager/security_manager.c",
        "components/boards/boards.c",
        "components/libraries/atomic/nrf_atomic.c",
        "components/libraries/atomic_fifo/nrf_atfifo.c",
        "components/libraries/atomic_flags/nrf_atflags.c",
        "components/libraries/balloc/nrf_balloc.c",
        "components/libraries/bsp/bsp.c",
        "components/libraries/bsp/bsp_btn_ble.c",
        "components/libraries/button/app_button.c",
        "components/libraries/crc16/crc16.c",
        "components/libraries/experimental_section_vars/nrf_section_iter.c",
        "components/libraries/fds/fds.c",
        "components/libraries/fstorage/nrf_fstorage.c",
        "components/libraries/fstorage/nrf_fstorage_sd.c",
        "components/libraries/hardfault/hardfault_implementation.c",
        "components/libraries/log/src/nrf_log_backend_rtt.c",
        "components/libraries/log/src/nrf_log_backend_serial.c",
        "components/libraries/log/src/nrf_log_backend_uart.c",
        "components/libraries/log/src/nrf_log_default_backends.c",
        "components/libraries/log/src/nrf_log_frontend.c",
        "components/libraries/log/src/nrf_log_str_formatter.c",
        "components/libraries/memobj/nrf_memobj.c",
        "components/libraries/pwr_mgmt/nrf_pwr_mgmt.c",
        "components/libraries/queue/nrf_queue.c",
        "components/libraries/ringbuf/nrf_ringbuf.c",
        "components/libraries/scheduler/app_scheduler.c",
        "components/libraries/sortlist/nrf_sortlist.c",
        "components/libraries/strerror/nrf_strerror.c",
        "components/libraries/timer/app_timer2.c",
        "components/libraries/timer/drv_rtc.c",
        "components/libraries/util/app_error.c",
        "components/libraries/util/app_error_handler_gcc.c",
        "components/libraries/util/app_error_weak.c",
        "components/libraries/util/app_util_platform.c",
        "components/libraries/util/nrf_assert.c",
        "components/softdevice/common/nrf_sdh.c",
        "components/softdevice/common/nrf_sdh_ble.c",
        "components/softdevice/common/nrf_sdh_soc.c",
        "examples/ble_peripheral/ble_app_cts_c/main.c",
        "external/fprintf/nrf_fprintf.c",
        "external/fprintf/nrf_fprintf_format.c",
        "external/segger_rtt/SEGGER_RTT.c",
        "external/segger_rtt/SEGGER_RTT_Syscalls_GCC.c",
        "external/segger_rtt/SEGGER_RTT_printf.c",
        "external/utf_converter/utf.c",
        "integration/nrfx/legacy/nrf_drv_clock.c",
        "integration/nrfx/legacy/nrf_drv_uart.c",
        "modules/nrfx/drivers/src/nrfx_clock.c",
        "modules/nrfx/drivers/src/nrfx_gpiote.c",
        "modules/nrfx/drivers/src/nrfx_uart.c",
        "modules/nrfx/drivers/src/nrfx_uarte.c",
        "modules/nrfx/drivers/src/prs/nrfx_prs.c",
        "modules/nrfx/mdk/gcc_startup_nrf52.S",
        "modules/nrfx/mdk/system_nrf52.c",
        "modules/nrfx/soc/nrfx_atomic.c",
    ],
    linker_cmd = "examples/ble_peripheral/ble_app_cts_c/pca10040/s132/armgcc/ble_app_cts_c_gcc_nrf52.ld",
    sdk_config_prefix = "examples/ble_peripheral/ble_app_cts_c/pca10040/s132/config",
    softdevice = "S132",
    visibility = ["//visibility:private"],
)

nRF5_binary(
    name = "ble_app_ancs_c",
    srcs = [
        "components/ble/ble_advertising/ble_advertising.c",
        "components/ble/ble_db_discovery/ble_db_discovery.c",
        "components/ble/ble_services/ble_ancs_c/ancs_app_attr_get.c",
        "components/ble/ble_services/ble_ancs_c/ancs_attr_parser.c",
        "components/ble/ble_services/ble_ancs_c/nrf_ble_ancs_c.c",
        "components/ble/ble_services/experimental_gatts_c/nrf_ble_gatts_c.c",
        "components/ble/common/ble_advdata.c",
        "components/ble/common/ble_conn_params.c",
        "components/ble/common/ble_conn_state.c",
        "components/ble/common/ble_srv_common.c",
        "components/ble/nrf_ble_gatt/nrf_ble_gatt.c",
        "components/ble/nrf_ble_gq/nrf_ble_gq.c",
        "components/ble/nrf_ble_qwr/nrf_ble_qwr.c",
        "components/ble/peer_manager/auth_status_tracker.c",
        "components/ble/peer_manager/gatt_cache_manager.c",
        "components/ble/peer_manager/gatts_cache_manager.c",
        "components/ble/peer_manager/id_manager.c",
        "components/ble/peer_manager/peer_data_storage.c",
        "components/ble/peer_manager/peer_database.c",
        "components/ble/peer_manager/peer_id.c",
        "components/ble/peer_manager/peer_manager.c",
        "components/ble/peer_manager/peer_manager_handler.c",
        "components/ble/peer_manager/pm_buffer.c",
        "components/ble/peer_manager/security_dispatcher.c",
        "components/ble/peer_manager/security_manager.c",
        "components/boards/boards.c",
        "components/libraries/atomic/nrf_atomic.c",
        "components/libraries/atomic_fifo/nrf_atfifo.c",
        "components/libraries/atomic_flags/nrf_atflags.c",
        "components/libraries/balloc/nrf_balloc.c",
        "components/libraries/bsp/bsp.c",
        "components/libraries/bsp/bsp_btn_ble.c",
        "components/libraries/button/app_button.c",
        "components/libraries/crc16/crc16.c",
        "components/libraries/experimental_section_vars/nrf_section_iter.c",
        "components/libraries/fds/fds.c",
        "components/libraries/fstorage/nrf_fstorage.c",
        "components/libraries/fstorage/nrf_fstorage_sd.c",
        "components/libraries/hardfault/hardfault_implementation.c",
        "components/libraries/log/src/nrf_log_backend_rtt.c",
        "components/libraries/log/src/nrf_log_backend_serial.c",
        "components/libraries/log/src/nrf_log_backend_uart.c",
        "components/libraries/log/src/nrf_log_default_backends.c",
        "components/libraries/log/src/nrf_log_frontend.c",
        "components/libraries/log/src/nrf_log_str_formatter.c",
        "components/libraries/memobj/nrf_memobj.c",
        "components/libraries/pwr_mgmt/nrf_pwr_mgmt.c",
        "components/libraries/queue/nrf_queue.c",
        "components/libraries/ringbuf/nrf_ringbuf.c",
        "components/libraries/scheduler/app_scheduler.c",
        "components/libraries/sortlist/nrf_sortlist.c",
        "components/libraries/strerror/nrf_strerror.c",
        "components/libraries/timer/app_timer2.c",
        "components/libraries/timer/drv_rtc.c",
        "components/libraries/util/app_error.c",
        "components/libraries/util/app_error_handler_gcc.c",
        "components/libraries/util/app_error_weak.c",
        "components/libraries/util/app_util_platform.c",
        "components/libraries/util/nrf_assert.c",
        "components/softdevice/common/nrf_sdh.c",
        "components/softdevice/common/nrf_sdh_ble.c",
        "components/softdevice/common/nrf_sdh_soc.c",
        "examples/ble_peripheral/ble_app_ancs_c/main.c",
        "external/fprintf/nrf_fprintf.c",
        "external/fprintf/nrf_fprintf_format.c",
        "external/segger_rtt/SEGGER_RTT.c",
        "external/segger_rtt/SEGGER_RTT_Syscalls_GCC.c",
        "external/segger_rtt/SEGGER_RTT_printf.c",
        "external/utf_converter/utf.c",
        "integration/nrfx/legacy/nrf_drv_clock.c",
        "integration/nrfx/legacy/nrf_drv_uart.c",
        "modules/nrfx/drivers/src/nrfx_clock.c",
        "modules/nrfx/drivers/src/nrfx_gpiote.c",
        "modules/nrfx/drivers/src/nrfx_uart.c",
        "modules/nrfx/drivers/src/nrfx_uarte.c",
        "modules/nrfx/drivers/src/prs/nrfx_prs.c",
        "modules/nrfx/mdk/gcc_startup_nrf52.S",
        "modules/nrfx/mdk/system_nrf52.c",
        "modules/nrfx/soc/nrfx_atomic.c",
    ],
    linker_cmd = "examples/ble_peripheral/ble_app_ancs_c/pca10040/s132/armgcc/ble_app_ancs_c_gcc_nrf52.ld",
    sdk_config_prefix = "examples/ble_peripheral/ble_app_ancs_c/pca10040/s132/config",
    softdevice = "S132",
    visibility = ["//visibility:private"],
)
